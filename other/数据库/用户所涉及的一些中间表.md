-- 用户收藏的简历
CREATE TABLE `user_favorite_resume` (
  `id` int(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_openid` varchar(100) NOT NULL,
  `resume_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_user_openid_resume` (`user_openid`),
  KEY `fk_resume_id` (`resume_id`),
  CONSTRAINT `fk_user_openid_resume` FOREIGN KEY (`user_openid`) REFERENCES `users` (`openid`) ON DELETE CASCADE,
  CONSTRAINT `fk_resume_id` FOREIGN KEY (`resume_id`) REFERENCES `wx_user_resume` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 用户收藏的论坛帖子
CREATE TABLE `user_favorite_forum` (
  `id` int(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_openid` varchar(100) NOT NULL,
  `forum_id` int(11) UNSIGNED NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_user_favorite_forum_user_openid` FOREIGN KEY (`user_openid`) REFERENCES `users` (`openid`) ON DELETE CASCADE,
  CONSTRAINT `fk_user_favorite_forum_forum_id` FOREIGN KEY (`forum_id`) REFERENCES `forum` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 用户关注的其他用户
CREATE TABLE `user_follow_user` (
  `id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` CHAR(36) NOT NULL,
  `followed_user_id` CHAR(36) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY (`user_id`, `followed_user_id`),
  CONSTRAINT `fk_user_follow_user_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`openid`) ON DELETE CASCADE,
  CONSTRAINT `fk_user_follow_user_followed_user_id` FOREIGN KEY (`followed_user_id`) REFERENCES `users` (`openid`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 用户关注的项目
CREATE TABLE `user_favorite_projects` (
  `id` INT NOT NULL AUTO_INCREMENT,  --为了便于查询
  `user_id` CHAR(36) NOT NULL,        --为了唯一标识项目
  `project_id` CHAR(36) NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`openid`) ON DELETE CASCADE,       --为了解决数据错乱，当用户id被删时，这个行就会消失
  CONSTRAINT `fk_project_id` FOREIGN KEY (`project_id`) REFERENCES `project_library` (`uuid`) ON DELETE CASCADE    --为了解决数据错乱，当项目id被删时，这个行就会消失
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;